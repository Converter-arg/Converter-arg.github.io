<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Convertiche</title>
  <style>
    :root{
      --bg:#0d0d0d; --panel:#151515; --muted:#9fb0c8; --text:#e6eef8; --accent:#76c7ff;
      --input:#1f1f1f; --border:rgba(255,255,255,0.06); --danger:#ff6b6b;
    }
    body.light{
      --bg:#f6f7fb; --panel:#ffffff; --muted:#5b6b7a; --text:#0f1720; --accent:#0077cc;
      --input:#ffffff; --border:rgba(0,0,0,0.08); --danger:#e06464;
    }
    body{margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;
      background:var(--bg);color:var(--text);font-family:Inter,Roboto,Arial,sans-serif;transition:.3s;}
    .card{width:100%;max-width:820px;background:var(--panel);border-radius:14px;padding:20px;
      box-shadow:0 8px 30px rgba(0,0,0,.6);border:1px solid var(--border);}
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px;}
    h1{margin:0;color:var(--accent);font-weight:600;font-size:1.1rem;}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    select,input,button{border-radius:10px;font-size:.95rem;}
    select,input[type="number"],input[type="text"]{background:var(--input);color:var(--text);
      border:1px solid var(--border);padding:7px 9px;}
    button{cursor:pointer;border:none;padding:8px 12px;font-weight:600}
    button.primary{background:var(--accent);color:var(--bg);}
    button.danger{background:var(--danger);color:#fff;}
    button.icon{background:transparent;color:var(--text);border:1px dashed var(--border);}
    textarea{width:97%;min-height:40px;max-height:300px;resize:none;overflow:hidden;
      background:var(--input);color:var(--text);border:1px dashed var(--border);
      border-radius:10px;padding:12px;font-size:1rem;margin-bottom:10px;transition:.2s;}
    #salida{min-height:40px;max-height:300px;overflow:hidden;padding:12px;border:1px dashed var(--border);border-radius:10px;
      font-family:ui-monospace,monospace;white-space:pre-wrap;word-break:break-word;
      transition:.2s;}
    table{width:100%;border-collapse:collapse;margin-top:12px;display:none;}
    th,td{padding:6px;border:1px dashed var(--border);text-align:center;}
    th{color:var(--accent);}
    #qrCanvas{margin-top:12px;display:none;background:#fff;border-radius:10px;}
    .small{font-size:.85rem;color:var(--muted);}
    /* estilo del input file */
    .file-input{display:none;}
    .file-label{display:inline-block;background:var(--accent);color:var(--bg);
      padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;}
    .file-label:hover{opacity:0.85;}
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>Convertiche</h1>
      <div class="controls">
        <select id="modo" onchange="onModoChange()">
          <option value="cesar">César</option>
          <option value="nato">Lengua Aérea (NATO)</option>
          <option value="binario">Binario</option>
          <option value="geringoso">Geringoso</option>
          <option value="hexadecimal">Hexadecimal</option>
          <option disabled>──────────</option>
          <option value="leerQR">Leer QR</option>
          <option value="crearQR">Crear QR</option>
        </select>
        <div id="extras"></div>
        <button class="icon" onclick="toggleTema()" id="themeBtn">🌙</button>
        <button class="danger" onclick="borrarTodo()">Borrar</button>
      </div>
    </header>
    <textarea id="entrada" placeholder="Escribe aquí..."></textarea>
    <div id="salida"></div>
    <canvas id="qrCanvas"></canvas>
    <div id="resultadoQR" class="small"></div>
    <table id="tabla"></table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
  <script>
    /* ===== Datos ===== */
    const NATO={A:"Alfa",B:"Bravo",C:"Charlie",D:"Delta",E:"Eco",F:"Foxtrot",G:"Golf",H:"Hotel",
      I:"India",J:"Juliett",K:"Kilo",L:"Lima",M:"Mike",N:"November",O:"Oscar",P:"Papa",Q:"Quebec",
      R:"Romeo",S:"Sierra",T:"Tango",U:"Uniform",V:"Victor",W:"Whiskey",X:"X-ray",Y:"Yankee",Z:"Zulu"};

    /* ===== Transformaciones ===== */
    const cesar=(txt,s)=>txt.replace(/[a-z]/gi,ch=>{
      const base=ch>='a'?'a':'A';return String.fromCharCode((ch.charCodeAt(0)-base.charCodeAt(0)+s+26)%26+base.charCodeAt(0));
    });
    const nato=t=>[...t].map(c=>/[a-z]/i.test(c)?NATO[c.toUpperCase()]:c===' ' ? '/' : c).join(' ');
    const bin=t=>[...t].map(c=>c.charCodeAt(0).toString(2).padStart(8,'0')).join(' ');
    const hex=t=>[...t].map(c=>c.charCodeAt(0).toString(16).toUpperCase()).join(' ');
    const ger=(t,p)=>t.replace(/[aeiouáéíóú]/gi,v=>v+p+v.toLowerCase());

    /* ===== Animación tipo scramble ===== */
    function scrambleTo(finalText,speed=30){
      const salida=document.getElementById("salida");
      const chars="█▓▒░<>#%$&?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let iterations=0;
      clearInterval(salida._scrambleTimer);
      salida._scrambleTimer=setInterval(()=>{
        let out="";
        for(let i=0;i<finalText.length;i++){
          if(i<iterations){ out+=finalText[i]; }
          else{ out+=chars[Math.floor(Math.random()*chars.length)]; }
        }
        salida.textContent=out;
        autoResizeSalida();
        if(iterations>=finalText.length){clearInterval(salida._scrambleTimer);}
        iterations++;
      },speed);
    }

    /* ===== UI ===== */
    function aplicarModo(anim=true){
      const modo=document.getElementById("modo").value;
      const entrada=document.getElementById("entrada").value||"";
      let res=entrada;

      // limpiar QR
      document.getElementById("qrCanvas").style.display="none";
      document.getElementById("resultadoQR").textContent="";

      if(modo==="cesar"){res=cesar(entrada,parseInt(document.getElementById("shift")?.value)||0);}
      else if(modo==="nato"){res=nato(entrada);}
      else if(modo==="binario"){res=bin(entrada);}
      else if(modo==="hexadecimal"){res=hex(entrada);}
      else if(modo==="geringoso"){const p=document.getElementById("pref")?.value||"p";res=ger(entrada,p);}
      else if(modo==="crearQR"){
        QRCode.toCanvas(document.getElementById("qrCanvas"),entrada,{width:220});
        document.getElementById("qrCanvas").style.display="block";
        res="QR generado abajo";
      }
      else if(modo==="leerQR"){res="";}

      if(anim){scrambleTo(res);} else{
        document.getElementById("salida").textContent=res;
        autoResizeSalida();
      }
    }

    function onModoChange(){
      const modo=document.getElementById("modo").value;
      const extras=document.getElementById("extras");const tabla=document.getElementById("tabla");
      extras.innerHTML="";tabla.style.display="none";tabla.innerHTML="";
      document.getElementById("qrCanvas").style.display="none"; 

      if(modo==="cesar"){extras.innerHTML='Desplazamiento: <input id="shift" type="number" value="3" style="width:60px">';}
      if(modo==="geringoso"){extras.innerHTML='Letra: <input id="pref" value="p" style="width:60px">';}
      if(modo==="crearQR"){extras.innerHTML='<button class="primary" onclick="aplicarModo(true)">Generar QR</button>';}
      if(modo==="leerQR"){
        extras.innerHTML='<input type="file" id="imagenQR" class="file-input" accept="image/*"><label for="imagenQR" class="file-label">📷 Seleccionar QR</label>';
        document.getElementById("imagenQR").addEventListener("change",leerQR);
      }
      if(modo==="nato"){tabla.innerHTML="<tr><th>Letra</th><th>Palabra</th></tr>"+Object.entries(NATO).map(([k,v])=>`<tr><td>${k}</td><td>${v}</td></tr>`).join("");tabla.style.display="table";}
      if(modo==="binario"){tabla.innerHTML="<tr><th>Letra</th><th>Binario</th></tr>"+Array.from({length:26},(_,i)=>{let ch=String.fromCharCode(65+i);return `<tr><td>${ch}</td><td>${ch.charCodeAt(0).toString(2).padStart(8,'0')}</td></tr>`;}).join("");tabla.style.display="table";}
      if(modo==="hexadecimal"){tabla.innerHTML="<tr><th>Letra</th><th>Hex</th></tr>"+Array.from({length:26},(_,i)=>{let ch=String.fromCharCode(65+i);return `<tr><td>${ch}</td><td>${ch.charCodeAt(0).toString(16).toUpperCase()}</td></tr>`;}).join("");tabla.style.display="table";}
      aplicarModo(true);
    }

    function borrarTodo(){
      document.getElementById("entrada").value="";
      document.getElementById("salida").textContent="";
      autoResizeEntrada();
      autoResizeSalida();
      document.getElementById("qrCanvas").style.display="none";
      document.getElementById("resultadoQR").textContent="";
    }

    function leerQR(){
      const f=document.getElementById("imagenQR").files[0];if(!f)return;
      const r=new FileReader();r.onload=e=>{
        const img=new Image();img.onload=()=>{
          const c=document.createElement("canvas");c.width=img.width;c.height=img.height;
          const ctx=c.getContext("2d");ctx.drawImage(img,0,0);
          const code=jsQR(ctx.getImageData(0,0,c.width,c.height).data,c.width,c.height);
          if(code){scrambleTo(code.data);}else{document.getElementById("salida").textContent="No se detectó QR";autoResizeSalida();}
        };img.src=e.target.result;
      };r.readAsDataURL(f);
    }

    function toggleTema(){
      document.body.classList.toggle("light");
      localStorage.setItem("tema",document.body.classList.contains("light")?"light":"dark");
      document.getElementById("themeBtn").textContent=document.body.classList.contains("light")?"☀️":"🌙";
    }

    // auto-resize entrada
    const entrada=document.getElementById("entrada");
    entrada.addEventListener("input",()=>{
      autoResizeEntrada();
      aplicarModo(false);
    });
    function autoResizeEntrada(){
      entrada.style.height="auto";
      entrada.style.height=entrada.scrollHeight+"px";
    }
    function autoResizeSalida(){
      const salida=document.getElementById("salida");
      salida.style.height="auto";
      salida.style.height=salida.scrollHeight+"px";
    }

    // init
    (function(){
      if(localStorage.getItem("tema")==="light"){
        document.body.classList.add("light");
        document.getElementById("themeBtn").textContent="☀️";
      }
      onModoChange();
      autoResizeEntrada();
      autoResizeSalida();
    })();
  </script>
</body>
</html>
